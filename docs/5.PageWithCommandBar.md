# 5. PageWithCommandBar - Componente de P谩gina con Barra de Comandos

## Descripci贸n

`PageWithCommandBar` es un componente wrapper que proporciona una estructura de p谩gina consistente con una barra de comandos (CommandBar) en la parte superior y contenido scrolleable debajo, siguiendo el patr贸n de Dynamics CRM.

## Ubicaci贸n
```
Frontend/Components/Base/Forms/PageWithCommandBar/
 PageWithCommandBar.razor
 PageWithCommandBar.razor.css
```

## Caracter铆sticas

- **Botones est谩ndar** incluidos autom谩ticamente: Atr谩s, Nuevo, Guardar (opcional)
- **Botones personalizados** via `CustomItems` y `FarItems`
- **Responsive overflow**: Botones se mueven autom谩ticamente al men煤 "..." cuando la ventana se achica
- **Submen煤s**: Soporte para men煤s anidados con posicionamiento inteligente
- **Integraci贸n perfecta** con RadzenLayout
- **Detecci贸n de tema** en tiempo real (light/dark mode)
- **Navegaci贸n flexible** para el bot贸n Atr谩s

## Uso B谩sico

```razor
@page "/mi-pagina"
@using Frontend.Components.Base.Forms.PageWithCommandBar

<PageWithCommandBar>
    <h1>Mi Contenido</h1>
    <p>El contenido de la p谩gina va aqu铆</p>
</PageWithCommandBar>
```

## Par谩metros

### Botones Est谩ndar

| Par谩metro | Tipo | Default | Descripci贸n |
|-----------|------|---------|-------------|
| `BackPath` | `string?` | null | Ruta para navegaci贸n del bot贸n Atr谩s |
| `OnBackClick` | `EventCallback` | - | Callback personalizado para el bot贸n Atr谩s |
| `UseHistoryBack` | `bool` | true | Usar history.back() si no hay BackPath ni OnBackClick |
| `NewPath` | `string?` | null | Ruta para el bot贸n Nuevo |
| `OnNewClick` | `EventCallback` | - | Callback personalizado para el bot贸n Nuevo |
| `ShowSave` | `bool` | true | Mostrar/ocultar el bot贸n Guardar |
| `OnSaveClick` | `EventCallback` | - | Callback para el bot贸n Guardar |

### Botones Personalizados

| Par谩metro | Tipo | Descripci贸n |
|-----------|------|-------------|
| `CustomItems` | `List<SimpleCommandBarItem>?` | Botones personalizados (lado izquierdo) |
| `FarItems` | `List<SimpleCommandBarItem>?` | Botones del lado derecho |
| `OverflowItems` | `List<SimpleCommandBarItem>?` | Botones que van directo al men煤 overflow |

### Contenido

| Par谩metro | Tipo | Descripci贸n |
|-----------|------|-------------|
| `ChildContent` | `RenderFragment?` | Contenido de la p谩gina |

## Ejemplos de Uso

### 1. P谩gina Simple con Botones Est谩ndar

```razor
<PageWithCommandBar BackPath="/categorias" 
                    NewPath="/categoria/new"
                    OnSaveClick="@SaveData">
    <h1>Editar Categor铆a</h1>
    <!-- Formulario aqu铆 -->
</PageWithCommandBar>
```

### 2. Con Botones Personalizados

```razor
<PageWithCommandBar CustomItems="@customItems" 
                    FarItems="@farItems"
                    ShowSave="false">
    <h1>Mi Lista</h1>
    <!-- Contenido aqu铆 -->
</PageWithCommandBar>

@code {
    private List<SimpleCommandBarItem> customItems = new() {
        new SimpleCommandBarItem { 
            Text = "Editar", 
            IconName = "edit", 
            Key = "edit",
            OnClick = (args) => EditItem()
        },
        new SimpleCommandBarItem { 
            Text = "Eliminar", 
            IconName = "delete", 
            Key = "delete",
            OnClick = (args) => DeleteItem()
        }
    };

    private List<SimpleCommandBarItem> farItems = new() {
        new SimpleCommandBarItem { 
            Text = "Exportar", 
            IconName = "download", 
            Key = "export",
            OnClick = (args) => ExportData()
        }
    };
}
```

### 3. Con Submen煤s

```razor
<PageWithCommandBar FarItems="@reportItems">
    <h1>Dashboard</h1>
    <!-- Contenido aqu铆 -->
</PageWithCommandBar>

@code {
    private List<SimpleCommandBarItem> reportItems = new() {
        new SimpleCommandBarItem { 
            Text = "Reportes", 
            IconName = "assessment", 
            Key = "reports",
            SubMenuItems = new List<SimpleCommandBarItem> {
                new SimpleCommandBarItem { 
                    Text = "Reporte General", 
                    IconName = "summarize", 
                    Key = "report-general",
                    OnClick = (args) => GenerateGeneralReport()
                },
                new SimpleCommandBarItem { 
                    Text = "Reporte Detallado", 
                    IconName = "description", 
                    Key = "report-detailed",
                    OnClick = (args) => GenerateDetailedReport()
                }
            }
        }
    };
}
```

### 4. Navegaci贸n Personalizada del Bot贸n Atr谩s

```razor
<PageWithCommandBar OnBackClick="@HandleCustomBack">
    <!-- Contenido -->
</PageWithCommandBar>

@code {
    private async Task HandleCustomBack()
    {
        // Validar antes de navegar
        if (hasUnsavedChanges)
        {
            var confirmed = await ShowConfirmDialog("驴Desea salir sin guardar?");
            if (!confirmed) return;
        }
        
        NavigationManager.NavigateTo("/previous-page");
    }
}
```

## Estructura de SimpleCommandBarItem

```csharp
public class SimpleCommandBarItem
{
    public string Text { get; set; } = string.Empty;
    public string IconName { get; set; } = string.Empty;
    public string Key { get; set; } = string.Empty;
    public Action<SimpleItemClickedArgs>? OnClick { get; set; }
    
    // Para submen煤s
    public List<SimpleCommandBarItem>? SubMenuItems { get; set; }
    public bool HasSubMenu => SubMenuItems?.Any() == true;
}
```

## Iconos Disponibles

Usa Material Design Icons. Ejemplos comunes:
- `arrow_back` - Flecha atr谩s
- `add` - Agregar/Nuevo
- `save` - Guardar
- `edit` - Editar
- `delete` - Eliminar
- `download` - Descargar/Exportar
- `assessment` - Reportes/An谩lisis
- `search` - Buscar
- `refresh` - Actualizar
- `settings` - Configuraci贸n

## Comportamiento Responsive

El componente autom谩ticamente:
- **1200px+**: Muestra todos los botones
- **992px-1199px**: Muestra botones principales, algunos van al "..."
- **768px-991px**: Solo botones cr铆ticos visibles
- **<768px**: Solo botones est谩ndar (Atr谩s, Nuevo, Guardar)

## Soporte de Temas

El componente detecta autom谩ticamente cambios de tema en tiempo real:
- **Modo claro**: Fondo blanco, texto negro
- **Modo oscuro**: Fondo #292929, texto blanco

## Integraci贸n con RadzenLayout

```razor
@* MainLayout.razor *@
<RadzenLayout>
    <RadzenHeader>
        <!-- Header content -->
    </RadzenHeader>
    
    <RadzenSidebar>
        <!-- Sidebar content -->
    </RadzenSidebar>
    
    <RadzenBody Style="padding: 0px !important">
        @Body  @* PageWithCommandBar se renderiza aqu铆 *@
    </RadzenBody>
</RadzenLayout>
```

## Casos de Uso Recomendados

### CRUD Pages
- **Lista**: Botones Nuevo, Editar, Eliminar, Exportar
- **Crear**: Botones Atr谩s, Guardar
- **Editar**: Botones Atr谩s, Guardar, Eliminar
- **Ver**: Botones Atr谩s, Editar

### P谩ginas de Dashboard
- **Reportes**: Submen煤s con diferentes tipos de reportes
- **Exportaci贸n**: M煤ltiples formatos de exportaci贸n
- **Acciones masivas**: Botones de procesamiento por lotes

## Ejemplo Completo: P谩gina de Lista

```razor
@page "/categorias"
@using Frontend.Components.Base.Forms.PageWithCommandBar

<PageTitle>Categor铆as</PageTitle>

<PageWithCommandBar CustomItems="@actionItems" 
                    FarItems="@utilityItems"
                    NewPath="/categoria/new">
    
    <div style="margin-bottom: 20px;">
        <h1> Gesti贸n de Categor铆as</h1>
        <p>Administra las categor铆as del sistema</p>
    </div>

    <!-- Filtros de b煤squeda -->
    <div class="filters-section">
        <!-- Componentes de filtro -->
    </div>

    <!-- Tabla de datos -->
    <div class="data-table">
        <!-- Tabla con categor铆as -->
    </div>

</PageWithCommandBar>

@code {
    private List<SimpleCommandBarItem> actionItems = new() {
        new SimpleCommandBarItem { 
            Text = "Editar", 
            IconName = "edit", 
            Key = "edit",
            OnClick = (args) => EditSelected()
        },
        new SimpleCommandBarItem { 
            Text = "Eliminar", 
            IconName = "delete", 
            Key = "delete",
            OnClick = (args) => DeleteSelected()
        }
    };

    private List<SimpleCommandBarItem> utilityItems = new() {
        new SimpleCommandBarItem { 
            Text = "Exportar", 
            IconName = "download", 
            Key = "export",
            SubMenuItems = new List<SimpleCommandBarItem> {
                new SimpleCommandBarItem { 
                    Text = "Exportar a Excel", 
                    IconName = "table_chart", 
                    Key = "export-excel",
                    OnClick = (args) => ExportToExcel()
                },
                new SimpleCommandBarItem { 
                    Text = "Exportar a PDF", 
                    IconName = "picture_as_pdf", 
                    Key = "export-pdf",
                    OnClick = (args) => ExportToPdf()
                }
            }
        }
    };

    private void EditSelected() { /* L贸gica de edici贸n */ }
    private void DeleteSelected() { /* L贸gica de eliminaci贸n */ }
    private void ExportToExcel() { /* L贸gica de exportaci贸n */ }
    private void ExportToPdf() { /* L贸gica de exportaci贸n */ }
}
```

## Notas Importantes

1. **Orden de prioridad** para bot贸n Atr谩s: `OnBackClick` > `BackPath` > `UseHistoryBack`
2. **Orden de prioridad** para bot贸n Nuevo: `OnNewClick` > `NewPath`
3. Los **submen煤s** se posicionan autom谩ticamente (izquierda/derecha) seg煤n el espacio disponible
4. El componente es **completamente responsive** y funciona en dispositivos m贸viles
5. **Integraci贸n autom谩tica** con el sistema de temas de la aplicaci贸n