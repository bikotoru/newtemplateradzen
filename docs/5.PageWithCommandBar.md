# 5. PageWithCommandBar - Componente de Página con Barra de Comandos

## Descripción

`PageWithCommandBar` es un componente wrapper que proporciona una estructura de página consistente con una barra de comandos (CommandBar) en la parte superior y contenido scrolleable debajo, siguiendo el patrón de Dynamics CRM.

## Ubicación
```
Frontend/Components/Base/Forms/PageWithCommandBar/
├── PageWithCommandBar.razor
└── PageWithCommandBar.razor.css
```

## Características

- **Botones estándar** incluidos automáticamente: Atrás, Nuevo, Guardar (opcional)
- **Botones personalizados** via `CustomItems` y `FarItems`
- **Responsive overflow**: Botones se mueven automáticamente al menú "..." cuando la ventana se achica
- **Submenús**: Soporte para menús anidados con posicionamiento inteligente
- **Integración perfecta** con RadzenLayout
- **Detección de tema** en tiempo real (light/dark mode)
- **Navegación flexible** para el botón Atrás

## Uso Básico

```razor
@page "/mi-pagina"
@using Frontend.Components.Base.Forms.PageWithCommandBar

<PageWithCommandBar>
    <h1>Mi Contenido</h1>
    <p>El contenido de la página va aquí</p>
</PageWithCommandBar>
```

## Parámetros

### Botones Estándar

| Parámetro | Tipo | Default | Descripción |
|-----------|------|---------|-------------|
| `BackPath` | `string?` | null | Ruta para navegación del botón Atrás |
| `OnBackClick` | `EventCallback` | - | Callback personalizado para el botón Atrás |
| `UseHistoryBack` | `bool` | true | Usar history.back() si no hay BackPath ni OnBackClick |
| `NewPath` | `string?` | null | Ruta para el botón Nuevo |
| `OnNewClick` | `EventCallback` | - | Callback personalizado para el botón Nuevo |
| `ShowSave` | `bool` | true | Mostrar/ocultar el botón Guardar |
| `OnSaveClick` | `EventCallback` | - | Callback para el botón Guardar |

### Botones Personalizados

| Parámetro | Tipo | Descripción |
|-----------|------|-------------|
| `CustomItems` | `List<SimpleCommandBarItem>?` | Botones personalizados (lado izquierdo) |
| `FarItems` | `List<SimpleCommandBarItem>?` | Botones del lado derecho |
| `OverflowItems` | `List<SimpleCommandBarItem>?` | Botones que van directo al menú overflow |

### Contenido

| Parámetro | Tipo | Descripción |
|-----------|------|-------------|
| `ChildContent` | `RenderFragment?` | Contenido de la página |

## Ejemplos de Uso

### 1. Página Simple con Botones Estándar

```razor
<PageWithCommandBar BackPath="/categorias" 
                    NewPath="/categoria/new"
                    OnSaveClick="@SaveData">
    <h1>Editar Categoría</h1>
    <!-- Formulario aquí -->
</PageWithCommandBar>
```

### 2. Con Botones Personalizados

```razor
<PageWithCommandBar CustomItems="@customItems" 
                    FarItems="@farItems"
                    ShowSave="false">
    <h1>Mi Lista</h1>
    <!-- Contenido aquí -->
</PageWithCommandBar>

@code {
    private List<SimpleCommandBarItem> customItems = new() {
        new SimpleCommandBarItem { 
            Text = "Editar", 
            IconName = "edit", 
            Key = "edit",
            OnClick = (args) => EditItem()
        },
        new SimpleCommandBarItem { 
            Text = "Eliminar", 
            IconName = "delete", 
            Key = "delete",
            OnClick = (args) => DeleteItem()
        }
    };

    private List<SimpleCommandBarItem> farItems = new() {
        new SimpleCommandBarItem { 
            Text = "Exportar", 
            IconName = "download", 
            Key = "export",
            OnClick = (args) => ExportData()
        }
    };
}
```

### 3. Con Submenús

```razor
<PageWithCommandBar FarItems="@reportItems">
    <h1>Dashboard</h1>
    <!-- Contenido aquí -->
</PageWithCommandBar>

@code {
    private List<SimpleCommandBarItem> reportItems = new() {
        new SimpleCommandBarItem { 
            Text = "Reportes", 
            IconName = "assessment", 
            Key = "reports",
            SubMenuItems = new List<SimpleCommandBarItem> {
                new SimpleCommandBarItem { 
                    Text = "Reporte General", 
                    IconName = "summarize", 
                    Key = "report-general",
                    OnClick = (args) => GenerateGeneralReport()
                },
                new SimpleCommandBarItem { 
                    Text = "Reporte Detallado", 
                    IconName = "description", 
                    Key = "report-detailed",
                    OnClick = (args) => GenerateDetailedReport()
                }
            }
        }
    };
}
```

### 4. Navegación Personalizada del Botón Atrás

```razor
<PageWithCommandBar OnBackClick="@HandleCustomBack">
    <!-- Contenido -->
</PageWithCommandBar>

@code {
    private async Task HandleCustomBack()
    {
        // Validar antes de navegar
        if (hasUnsavedChanges)
        {
            var confirmed = await ShowConfirmDialog("¿Desea salir sin guardar?");
            if (!confirmed) return;
        }
        
        NavigationManager.NavigateTo("/previous-page");
    }
}
```

## Estructura de SimpleCommandBarItem

```csharp
public class SimpleCommandBarItem
{
    public string Text { get; set; } = string.Empty;
    public string IconName { get; set; } = string.Empty;
    public string Key { get; set; } = string.Empty;
    public Action<SimpleItemClickedArgs>? OnClick { get; set; }
    
    // Para submenús
    public List<SimpleCommandBarItem>? SubMenuItems { get; set; }
    public bool HasSubMenu => SubMenuItems?.Any() == true;
}
```

## Iconos Disponibles

Usa Material Design Icons. Ejemplos comunes:
- `arrow_back` - Flecha atrás
- `add` - Agregar/Nuevo
- `save` - Guardar
- `edit` - Editar
- `delete` - Eliminar
- `download` - Descargar/Exportar
- `assessment` - Reportes/Análisis
- `search` - Buscar
- `refresh` - Actualizar
- `settings` - Configuración

## Comportamiento Responsive

El componente automáticamente:
- **1200px+**: Muestra todos los botones
- **992px-1199px**: Muestra botones principales, algunos van al "..."
- **768px-991px**: Solo botones críticos visibles
- **<768px**: Solo botones estándar (Atrás, Nuevo, Guardar)

## Soporte de Temas

El componente detecta automáticamente cambios de tema en tiempo real:
- **Modo claro**: Fondo blanco, texto negro
- **Modo oscuro**: Fondo #292929, texto blanco

## Integración con RadzenLayout

```razor
@* MainLayout.razor *@
<RadzenLayout>
    <RadzenHeader>
        <!-- Header content -->
    </RadzenHeader>
    
    <RadzenSidebar>
        <!-- Sidebar content -->
    </RadzenSidebar>
    
    <RadzenBody Style="padding: 0px !important">
        @Body  @* PageWithCommandBar se renderiza aquí *@
    </RadzenBody>
</RadzenLayout>
```

## Casos de Uso Recomendados

### CRUD Pages
- **Lista**: Botones Nuevo, Editar, Eliminar, Exportar
- **Crear**: Botones Atrás, Guardar
- **Editar**: Botones Atrás, Guardar, Eliminar
- **Ver**: Botones Atrás, Editar

### Páginas de Dashboard
- **Reportes**: Submenús con diferentes tipos de reportes
- **Exportación**: Múltiples formatos de exportación
- **Acciones masivas**: Botones de procesamiento por lotes

## Ejemplo Completo: Página de Lista

```razor
@page "/categorias"
@using Frontend.Components.Base.Forms.PageWithCommandBar

<PageTitle>Categorías</PageTitle>

<PageWithCommandBar CustomItems="@actionItems" 
                    FarItems="@utilityItems"
                    NewPath="/categoria/new">
    
    <div style="margin-bottom: 20px;">
        <h1>📂 Gestión de Categorías</h1>
        <p>Administra las categorías del sistema</p>
    </div>

    <!-- Filtros de búsqueda -->
    <div class="filters-section">
        <!-- Componentes de filtro -->
    </div>

    <!-- Tabla de datos -->
    <div class="data-table">
        <!-- Tabla con categorías -->
    </div>

</PageWithCommandBar>

@code {
    private List<SimpleCommandBarItem> actionItems = new() {
        new SimpleCommandBarItem { 
            Text = "Editar", 
            IconName = "edit", 
            Key = "edit",
            OnClick = (args) => EditSelected()
        },
        new SimpleCommandBarItem { 
            Text = "Eliminar", 
            IconName = "delete", 
            Key = "delete",
            OnClick = (args) => DeleteSelected()
        }
    };

    private List<SimpleCommandBarItem> utilityItems = new() {
        new SimpleCommandBarItem { 
            Text = "Exportar", 
            IconName = "download", 
            Key = "export",
            SubMenuItems = new List<SimpleCommandBarItem> {
                new SimpleCommandBarItem { 
                    Text = "Exportar a Excel", 
                    IconName = "table_chart", 
                    Key = "export-excel",
                    OnClick = (args) => ExportToExcel()
                },
                new SimpleCommandBarItem { 
                    Text = "Exportar a PDF", 
                    IconName = "picture_as_pdf", 
                    Key = "export-pdf",
                    OnClick = (args) => ExportToPdf()
                }
            }
        }
    };

    private void EditSelected() { /* Lógica de edición */ }
    private void DeleteSelected() { /* Lógica de eliminación */ }
    private void ExportToExcel() { /* Lógica de exportación */ }
    private void ExportToPdf() { /* Lógica de exportación */ }
}
```

## Notas Importantes

1. **Orden de prioridad** para botón Atrás: `OnBackClick` > `BackPath` > `UseHistoryBack`
2. **Orden de prioridad** para botón Nuevo: `OnNewClick` > `NewPath`
3. Los **submenús** se posicionan automáticamente (izquierda/derecha) según el espacio disponible
4. El componente es **completamente responsive** y funciona en dispositivos móviles
5. **Integración automática** con el sistema de temas de la aplicación